# Concurrent Networked Board Game - Makefile
# Compile with: make
# Run server: ./server
# Run client: ./client <slot> <name>

CC = gcc
CFLAGS = -Wall -Wextra -pthread -g
LDFLAGS = -pthread -lrt

# Targets
SERVER = server
CLIENT = client

# Source files
SERVER_SRC = server.c
CLIENT_SRC = client.c
COMMON_HDR = common.h

.PHONY: all clean run-server

all: $(SERVER) $(CLIENT)

$(SERVER): $(SERVER_SRC) $(COMMON_HDR)
	$(CC) $(CFLAGS) -o $@ $(SERVER_SRC) $(LDFLAGS)
	@echo "Server compiled successfully!"

$(CLIENT): $(CLIENT_SRC) $(COMMON_HDR)
	$(CC) $(CFLAGS) -o $@ $(CLIENT_SRC) $(LDFLAGS)
	@echo "Client compiled successfully!"

clean:
	rm -f $(SERVER) $(CLIENT)
	rm -f /tmp/game_pipe_*
	rm -f game.log scores.txt
	@echo "Cleaned up!"

run-server: $(SERVER)
	./$(SERVER)

# Helper targets for running multiple clients
client1: $(CLIENT)
	./$(CLIENT) 0 Player1

client2: $(CLIENT)
	./$(CLIENT) 1 Player2

client3: $(CLIENT)
	./$(CLIENT) 2 Player3

client4: $(CLIENT)
	./$(CLIENT) 3 Player4

client5: $(CLIENT)
	./$(CLIENT) 4 Player5

help:
	@echo "=== Race to 100 - Build & Run Instructions ==="
	@echo ""
	@echo "Build:"
	@echo "  make          - Compile server and client"
	@echo "  make clean    - Remove binaries and temp files"
	@echo ""
	@echo "Run:"
	@echo "  make run-server  - Start the game server"
	@echo "  make client1     - Start client as Player1 (slot 0)"
	@echo "  make client2     - Start client as Player2 (slot 1)"
	@echo "  make client3     - Start client as Player3 (slot 2)"
	@echo ""
	@echo "Or run manually:"
	@echo "  ./server"
	@echo "  ./client <slot 0-4> <player_name>"
	@echo ""
	@echo "Example:"
	@echo "  Terminal 1: ./server"
	@echo "  Terminal 2: ./client 0 Alice"
	@echo "  Terminal 3: ./client 1 Bob"
	@echo "  Terminal 4: ./client 2 Charlie"
